
            const puppeteer = require('puppeteer');
const fs = require('fs');
const path = require('path');

const startUrl = 'http://www.deviantart.com'; // Starting URL of your website

async function downloadImage(page, url, filepath) {
    const viewSource = await page.goto(url);
    fs.writeFile(filepath, await viewSource.buffer(), function(err) {
        if (err) {
            return console.log(err);
        }
        //console.log(`The file was saved as ${filepath}`);
    });
}

async function scrapePages(startUrl) {
    //const browser = await puppeteer.launch();
    const browser = await puppeteer.launch({ headless: false });

    const page = await browser.newPage();
    await page.setViewport({ width: 1920, height: 1080 });

    let url = startUrl;
    let hasNextPage = true;
    let pageCount = 1;

    while (hasNextPage) {
        try {
            console.log(`Starting to scrape page ${pageCount}: ${url}`);
            
            await page.goto(url, { waitUntil: 'networkidle2', timeout: 30000 });
            console.log('Page loaded successfully');

            // Retrieve all images with property="contentUrl" from each div
            const images = await page.$$eval('img[property="contentUrl"]', imgs => imgs.map(img => img.getAttribute('src')));
            console.log(`Found ${images.length} images`);

            // Download images
            for (const imgUrl of images) {
                var imgtmpname = imgUrl.split('/');
                var imgname = imgtmpname[imgtmpname.length - 1];
                console.log(`Downloading ${imgname}`);
                const filename = path.basename(new URL(imgUrl).pathname);
                await downloadImage(page, imgUrl, path.join(__dirname, filename));
                console.log(`Downloaded ${filename}`);
            }
            console.log('All images downloaded successfully');

            const nextPageButtonText = 'Next';
            const nextPageButton = await page.evaluateHandle(() => {
                const buttons = [...document.querySelectorAll('a')]; // Select all anchor tags
                return buttons.find(button => button.textContent.includes('Next')); // Find the button that includes the text "Next"
            });
            if (nextPageButton) {
                await nextPageButton.click();
                pageCount++;
                console.log('Clicked on the Next Page button');
            } else {
                console.log('No more pages to scrape');
                hasNextPage = false;
            }
        } catch (error) {
            console.error(`Error scraping ${url}:`, error.message);
            hasNextPage = false; // Stop scraping on error
        }
    }

    await browser.close();
}

scrapePages(startUrl);












///////////////////////

  //check if the folder "jpg" exists, if not create it
  if (!fs.existsSync(path.join(__dirname, 'jpg'))) {
    fs.mkdir(path.join(__dirname, 'jpg'));
}
//check if the file "images_links.txt" exists, if not create it
if (!fs.existsSync(path.join(__dirname, 'jpg', 'images_links.txt'))) {
    fs.writeFile(path.join(__dirname, 'jpg', 'images_links.txt'), '');
}

//writing the url of the image to a file txt named "images_links.txt" in the folder "jpg" without losing the previous urls
fs.readFile(path.join(__dirname, 'jpg', 'images_links.txt'), 'utf8')
    .then(data => {
        fs.writeFile(path.join(__dirname, 'jpg', 'images_links.txt'), data + imgUrl + '\n');
    })
    .catch(err => {
        fs.writeFile(path.join(__dirname, 'jpg', 'images_links.txt'), imgUrl + '\n');
    });


    














            
            
            
            
            
            
            
            
            
            
            
            
            const nextPageButtonText = 'Next';
            const nextPageButton = await page.evaluateHandle(() => {
                const buttons = [...document.querySelectorAll('a')]; // Select all anchor tags
                return buttons.find(button => button.textContent.includes('Next')); // Find the button that includes the text "Next"
            });
            if (nextPageButton) {
                await nextPageButton.click();
                pageCount++;
                console.log('Clicked on the Next Page button');
            } else {
                console.log('No more pages to scrape');
                hasNextPage = false;
            }